<html>
<head>
	<title>Projna</title>
    <meta charset="utf-8">
    <link rel="shortcut icon" href="../images/logo.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <script src="https://cdn.bootcss.com/jquery/3.1.0/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script src="/scripts/utility.js"></script>
    <link rel="stylesheet" type="text/css" href="/css/mystyle.css"/>
</head>
<body>
	<div class = "container-fluid">
		<div id = "divH"></div>
		<div id = "divC" class = "container">
			<div id = "intro">
				<h1>Profile</h1>
				<h3>Well, it's the profle.</h3>
			</div>
			<div>
				<div id = "working">
					<div id = "profile" class="form-group">
						<label id = "whos">MY Profile</label>
						<div>
							<!-- here make the profile tabel show up -->
							<table>
							<tbody>
								<tr>
									<td>Name</td>
									<td id ="nickname">guzhao</td>
								</tr>
								<tr>
									<td>Email</td>
									<td><input id = "email" placeholder = "gz@qq.com"></td>
								</tr>
								<tr>
									<td>selfie</td>
									<td><img id = "pic" src=""></td>
								</tr>
							</tbody>
						</table>
						</div>
					</div>
				</div>
				<button id = "submit" class="btn btn-default">Submit</button>
			</div>
		</div>
		<div id = "divF" ></div>
	</div>
</body>
<script type="text/javascript">
//load the page html
	$("#divH").load("/pages/utility.html #divheader");
	$("#divF").load("/pages/utility.html #divfooter");
</script>
<script type="text/javascript">
//make the fake sample pageData for this building page


function updatePage(){
	pageData.build.id = "reseter@sina.com";
	pageData.build.data.profile = "";
	pageData.project.id = "profile";
	updateProfileBuilding();
}
function updateProfileBuilding(){
//ajax and update project bookseeds' pageData
	$.ajax({
		type:"GET",url:"/project/load/profile",data:{_id : pageData.login},
		async:false,
		success: function(msg){
			pageData.build.data.profile = msg.project.data.profile;
		},
		error: function(msg){alert("somethin xiaoyue!");}
	});
}

function renderPage(){
	renderProfileBuilding();
}

function renderProfileBuilding(){
//render bookseeds page with pageData
	renderProjnaName(pageData.loginName);

	var profile = pageData.build.data.profile;

	$("#profile").find("#whos").val(pageData.login + "'s Profile");
	$("#nickname").text(profile.nickname);
	$("#email").attr("placeholder", profile.email);
	$("#pic").attr("src",'/images/' + profile.pic + '.jpg');

}

//handle input submit the book seeds user edited
$("#submit").on("click",function(event){
	submitProfile();
});

function submitProfile(){
	var pf ={
		nickname : '',
		email : '',
		pic : ''
	};
	pf.nickname = $("#nickname").val();
	pf.email = $("#email").val();
	var str = $("#pic").attr("src");
	var index = str.lastIndexOf("\/"); 
	var pic = str.substring(index + 1, str.length);
	pf.pic = pic.substring(0, pic.lastIndexOf("."));
	//here get profile data????????????????????????????????______________
	if(pf != ""){
		$.ajax({
			type : "POST",
			url : "/project/edit/addProfile",
			data: {profile: pf},async:true,
			success : function(msg){
				window.location.href='/project/profile/build/'+pageData.login;
			},
			error : function(msg){
				alert("something xiaoxue!");
			}
		});
	}else{
		alert("Hey! It's empty!");
	}
	
}
</script>
</html>









